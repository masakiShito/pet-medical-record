# 画面詳細：S05 記録登録/編集

## 1. 目的
体調・体重・投薬・通院をまとめて入力し、時系列で振り返れる記録を作成/更新する。

---

## 2. URL
- `/pets/:petId/records/new  または  /pets/:petId/records/:recordId/edit`

---

## 3. 対象ユーザー / 権限
- MVP：認証なし（シングルユーザー想定）

---

## 4. 画面構成（概要）
- フォーム（セクション分割：体調/体重/投薬/通院）
- フッター：保存/キャンセル（編集は削除も）

---

## 5. 画面項目一覧
| No | 項目名 | 種別 | 表示データ | 状態 | 必須 | 備考 |
|---|---|---|---|---|---|---|
| 1 | 記録日 | 日付 | — | recorded_on | 必須 | YYYY-MM-DD |
| 2 | タイトル | テキスト | — | title | 任意 | 0〜100文字 |
| 3 | 体調スコア | セレクト/スライダー | — | condition_level | 任意 | 1〜5 |
| 4 | 食欲スコア | セレクト/スライダー | — | appetite_level | 任意 | 1〜5 |
| 5 | 便スコア | セレクト/スライダー | — | stool_level | 任意 | 1〜5 |
| 6 | メモ | テキストエリア | — | memo | 任意 | 上限は実装で制限可 |
| 7 | 体重（複数行） | 繰返しフォーム | weights | weights[] | 任意 | 追加/削除可 |
| 8 | 投薬（複数行） | 繰返しフォーム | medications | medications[] | 任意 | 追加/削除可 |
| 9 | 通院（複数行） | 繰返しフォーム | vet_visits | vet_visits[] | 任意 | 追加/削除可 |
| 10 | 保存 | ボタン | — | — | — | POST/PUT（子要素一括） |
| 11 | 削除（編集のみ） | ボタン | — | — | — | DELETE（論理削除） |
| 12 | キャンセル | ボタン | — | — | — | newはS04、editはS06へ戻る |


---

## 6. 操作・イベント一覧
| イベント | 処理概要 | 呼び出すAPI | 備考 |
|---|---|---|---|
| 初期表示（新規） | 空フォーム（recorded_onは当日を初期値） | — |  |
| 初期表示（編集） | 記録詳細を取得しフォームに反映 | GET /pets/{pet_id}/records/{record_id} |  |
| 体重行追加/削除 | 配列を更新 | — | 保存時に一括送信 |
| 投薬行追加/削除 | 配列を更新 | — | 同上 |
| 通院行追加/削除 | 配列を更新 | — | 同上 |
| 保存（新規） | 入力検証→作成→S06へ | POST /pets/{pet_id}/records |  |
| 保存（編集） | 入力検証→更新→S06へ | PUT /pets/{pet_id}/records/{record_id} | 置換方式で同期推奨 |
| 削除（編集のみ） | 論理削除→S04へ | DELETE /pets/{pet_id}/records/{record_id} | 確認ダイアログ推奨 |
| キャンセル | 遷移元へ戻る | — | new=S04, edit=S06 |


---

## 7. 使用API
- `GET /api/pets/{pet_id}/records/{record_id}`（編集初期表示）
- `POST /api/pets/{pet_id}/records`（新規保存）
- `PUT /api/pets/{pet_id}/records/{record_id}`（編集保存）
- `DELETE /api/pets/{pet_id}/records/{record_id}`（削除）

---

## 8. バリデーション / 入力ルール（MVP）
- recorded_on：必須（YYYY-MM-DD）
- title：0〜100文字
- condition_level/appetite_level/stool_level：1〜5（任意）
- weights[].weight_kg：数値（0.00〜999.99）
- medications[].name：必須（1〜100文字）※行が存在する場合
- vet_visits[].cost_yen：0以上の整数（任意）
- 各配列は空でもOK（体重だけ/通院だけ等）

---

## 9. エラー/例外時の表示
- 保存失敗：エラートースト（detail表示）
- バリデーションエラー：該当行/項目にエラー表示
- 編集初期表示失敗：戻る+再試行

---

## 10. 備考（将来拡張）
- 将来：下書き、テンプレ（よく使う薬/病院）、音声入力、添付（画像/検査結果）
