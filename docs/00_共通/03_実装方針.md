# 実装方針

Pet Medical Record App（ペットカルテアプリ）

---

## 1. 目的

本書は、**技術選定・実装ルール・コーディング方針を明確化し、一貫性を保つ**ことを目的とする。

---

## 2. 技術スタック

### 2.1 フロントエンド

| 項目 | 技術 | バージョン |
| --- | --- | --- |
| フレームワーク | React | 最新安定版 |
| ビルドツール | Vite | 最新安定版 |
| スタイル | Tailwind | - |
| 状態管理 | useState / useContext（必要時） | - |
| ルーティング | React Router（将来導入） | - |

### 2.2 バックエンド

| 項目 | 技術 | バージョン |
| --- | --- | --- |
| フレームワーク | FastAPI | 最新安定版 |
| ORM | SQLAlchemy | 最新安定版 |
| DB接続 | PyMySQL + cryptography | - |
| 環境変数 | python-dotenv | - |

### 2.3 データベース

| 項目 | 技術 |
| --- | --- |
| RDBMS | MySQL 8.x |
| エンジン | InnoDB |
| 文字コード | utf8mb4 |

### 2.4 インフラ

| 項目 | 技術 |
| --- | --- |
| コンテナ | Docker + docker-compose |
| CPU | Apple Silicon（arm64） |

---

## 3. コーディング方針

### 3.1 フロントエンド（React）

#### 基本ルール

- 関数コンポーネント + Hooks
- クラスコンポーネントは使用しない
- propsは極力最小限に
- useEffectの依存配列を必ず管理

#### ディレクトリ構成

```
src/
├── components/   # 再利用可能なUI部品
├── pages/        # 画面単位のコンポーネント
├── hooks/        # カスタムフック
├── utils/        # ユーティリティ関数
├── App.jsx       # ルートコンポーネント
└── main.jsx      # エントリポイント
```

#### スタイル

- CSS Modules または Vanilla CSS
- インラインスタイルは最小限
- BEM記法は不要（Modules前提）

---

### 3.2 バックエンド（FastAPI）

#### 基本ルール

- 型ヒント必須
- Pydanticでバリデーション
- 例外処理を明示
- ドキュメント（docstring）推奨

#### ディレクトリ構成（将来）

```
backend/
├── main.py           # エントリポイント
├── models.py         # SQLAlchemy models
├── schemas.py        # Pydantic schemas
├── routes/           # APIルート
├── services/         # ビジネスロジック
└── repositories/     # DB操作
```

#### レスポンス形式

- 成功: `{"status": "ok", "data": {...}}`
- エラー: `{"status": "error", "detail": "..."}`

---

## 4. データベース設計方針

- 論理削除を基本とする（is_deleted）
- タイムスタンプは必須（created_at, updated_at）
- 外部キー制約を設定
- インデックスは必要最小限

---

## 5. API設計方針

- RESTful設計
- エンドポイントは複数形リソース
- ステータスコード適切に返却
  - 200: 成功
  - 201: 作成成功
  - 400: リクエストエラー
  - 404: Not Found
  - 500: サーバーエラー

---

## 6. エラーハンドリング

### 6.1 フロントエンド

- try-catch必須
- エラーメッセージはユーザー向けに変換
- ネットワークエラー・タイムアウトを考慮

### 6.2 バックエンド

- HTTPExceptionを活用
- ログ出力（開発時はprint可）
- エラー詳細をレスポンスに含める

---

## 7. 環境分離

| 環境 | 説明 |
| --- | --- |
| development | ローカル開発（Docker） |
| production | 本番（将来） |

---

## 8. テスト方針（将来）

- フロントエンド: Vitest
- バックエンド: pytest
- E2E: Playwright（検討）

---

## 9. Git運用

- ブランチ戦略: GitHub Flow
- コミットメッセージ: Conventional Commits推奨
- PR前にローカル動作確認必須

---

## 10. パフォーマンス方針

- MVPでは過度な最適化不要
- N+1問題は回避
- 無駄なAPIコール削減

---

以上
